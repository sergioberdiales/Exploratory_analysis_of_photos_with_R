---
title: "Exploratory_analysis_of_photos_with_R"
author: "Sergio Berdiales"
date: "2018-02-27"
output: html_document
---

The objective of this script is to make an exploratory analysis of the photos I took during my holidays in Boston last summer. Something very simple and descriptive.

First of all we must load the packages we are going to use. Besides the "usual suspects" (dplyr, ggplot, tidyr, etc.) I am going to use a very useful package for photographers. Its name is exifR and it is going to help us extract the metadata from our photos.

```{r message = FALSE, warning = FALSE}
library(dplyr)
library(ggplot2)
library(data.table)
library(lubridate)
library(tidyr)
library(xlsx)
library(readr)
library(rmarkdown)
library(scales)
```

We create a list with all the photos and pass it through the exifr function from the exifR package. My camera is a Canon 6D and I took all my photos in RAW format. So, I set the pattern argument to "*.CR2".
I save the output file as a csv: 

```{r message = FALSE, warning = FALSE}
# list.cr2 <- list.files(pattern = "*.CR2")
# exifbos <- exifr(list.cr2)
# write.csv(exifbos, 'exifbos.csv', row.names = F)
```

We import the csv file as a data.frame and see how many observations and variables it has.

```{r message = FALSE, warning = FALSE}
exifbos <- read_csv("exifbos.csv", col_types = cols(.default = "c"))
dim(exifbos)
```

343 variables with information from 1369 photos. I don't need so much information for this analysis. 

If you want to take a look at the information stored in the raw metadata you can visit this web: http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Canon.html#CameraInfo6D 

I select just 11 variables from the table and I make some transformations to make the analysis possible.
```{r message = FALSE, warning = FALSE}

# I have a problem related with the time zone when I try to generate the html with Knit. I solve the problem setting the time zone to "Europe/Madrid"

Sys.setenv(TZ="Europe/Madrid")

# https://stackoverflow.com/questions/47314121/r-error-unknown-timezone-with-as-posixct


exifbos1 <- select(exifbos,
SourceFile,
DateTimeOriginal, 
Model, 
LensModel, 
CanonExposureMode,
FocusMode,
MeteringMode,
ContinuousDrive,
ShutterSpeed,
Aperture, 
ISO)

# I use the ymd_hms function from the lubridate package to convert the "DateTimeOriginal" variable to Date class. 
# I also change the class of the variables "Lens", "ShutterSpeed", "Aperture" and "ISO" to Factor.

exifbos1$DateTimeOriginal <- ymd_hms(exifbos1$DateTimeOriginal) 
exifbos1$ShutterSpeed <- as.factor(exifbos1$ShutterSpeed)
exifbos1$Aperture <- as.factor(exifbos1$Aperture)
exifbos1$ISO <- as.numeric(exifbos1$ISO)
exifbos1$CanonExposureMode <- as.factor(exifbos1$CanonExposureMode)
exifbos1$FocusMode <- as.factor(exifbos1$FocusMode)
exifbos1$MeteringMode <- as.factor(exifbos1$MeteringMode)
exifbos1$ContinuousDrive <- as.factor(exifbos1$ContinuousDrive)
exifbos1$Model <- as.factor(exifbos1$Model)
exifbos1$LensModel <- as.factor(exifbos1$LensModel)
```

We take a look to the data with summary
```{r }
summary(exifbos1)

```
Photos distribution by day-hour and lense

I plot the photos in a scatter plot, with the month days on the x axis, the hours on the y axis and the lenses by color:

```{r , echo=FALSE}

# We create another column with just the time of the photos, stripping the Date
#exifbos1 <- exifbos1 %>% mutate(hms = exifbos1$DateTimeOriginal)            
# https://learnr.wordpress.com/2010/02/25/ggplot2-plotting-dates-hours-and-minutes/

exifbos1$hms <- format(exifbos1$DateTimeOriginal, format = "%H:%M:%S")
exifbos1$hms <- as.POSIXct(exifbos1$hms, format = "%H:%M:%S")

# Limits of the y-axis

end <- as.POSIXct("2018-05-12 24:00:00")
start <- as.POSIXct("2018-05-12 09:00:00")

ggplot(exifbos1, aes(x = as.factor(day(DateTimeOriginal)), y = hms, col = LensModel, alpha = 1)) +
geom_jitter(width = 0.5, height = 0) +
theme(legend.position ="top") + 
labs(x = "Days (July - 2018)", y = "Time of the photo") +
scale_y_datetime(expand = c(0, 0),
                 limits = c(start, end), 
                 breaks = seq(start, end, "1 hours"), 
                 labels = strftime(seq(start, end, "1 hours"), "%H:%S"))
                 
                 #labels = date_format("%H:%M"))
  

```

